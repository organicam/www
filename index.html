<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OrganiCAM - Inteligentny System Monitoringu Rolniczego</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css" rel="stylesheet">
</head>
<body class="bg-gray-50">
    <!-- Language Selector -->
    <div class="fixed top-0 right-0 m-4 z-50">
        <select id="language-selector" class="bg-white border rounded-lg px-4 py-2 focus:outline-none focus:border-green-500">
            <option value="pl">Polski</option>
            <option value="en">English</option>
            <option value="de">Deutsch</option>
            <option value="fr">Français</option>
        </select>
    </div>

    <!-- Navigation -->
    <nav class="fixed w-full bg-white shadow-lg z-40">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <div class="text-2xl font-bold text-green-600">OrganiCAM</div>
                <div class="hidden md:flex space-x-8" id="nav-links">
                    <!-- Filled dynamically by JavaScript -->
                </div>
            </div>
        </div>
    </nav>

    <!-- Content sections will be similar to previous HTML but with data-lang-key attributes -->
    <!-- Example for hero section: -->
    <section id="home" class="pt-20 pb-32 bg-gradient-to-r from-green-500 to-green-600">
        <div class="container mx-auto px-4 flex flex-col md:flex-row items-center">
            <div class="md:w-1/2 text-white" data-aos="fade-right">
                <h1 class="text-5xl font-bold mb-6" data-lang-key="hero.title"></h1>
                <p class="text-xl mb-8" data-lang-key="hero.subtitle"></p>
                <a href="#pricing" class="bg-white text-green-600 px-8 py-3 rounded-full font-bold hover:bg-gray-100 transition" data-lang-key="hero.cta">
                </a>
            </div>
            <div class="md:w-1/2 mt-8 md:mt-0" data-aos="fade-left">
                <img src="/api/placeholder/600/400" alt="OrganiCAM Tower" class="rounded-lg shadow-xl">
            </div>
        </div>
    </section>

    <!-- Rest of the HTML structure remains similar but with data-lang-key attributes -->

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
    <script>
        // Load configuration
        let config = null;
        let currentLang = 'pl';
        
        async function loadConfig() {
            try {
                const response = await fetch('/local.json');
                config = await response.json();
                await updateLanguage(currentLang);
            } catch (error) {
                console.error('Error loading configuration:', error);
            }
        }

        function updateLanguage(lang) {
            currentLang = lang;
            document.documentElement.lang = lang;
            
            // Update all elements with data-lang-key
            document.querySelectorAll('[data-lang-key]').forEach(element => {
                const key = element.getAttribute('data-lang-key');
                const value = getTranslation(key, lang);
                if (value) {
                    if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                        element.placeholder = value;
                    } else {
                        element.textContent = value;
                    }
                }
            });

            // Update currency and prices
            updatePrices(lang);
        }

        function getTranslation(key, lang) {
            const keys = key.split('.');
            let value = config.translations;
            
            for (const k of keys) {
                if (value && value[k]) {
                    value = value[k];
                } else {
                    return null;
                }
            }

            return value[lang] || value;
        }

        function updatePrices(lang) {
            const currency = config.languages[lang].currency;
            const symbol = config.languages[lang].currencySymbol;
            
            document.querySelectorAll('[data-price]').forEach(element => {
                const basePrice = parseFloat(element.getAttribute('data-price'));
                const convertedPrice = convertPrice(basePrice, 'PLN', currency);
                element.textContent = `${convertedPrice.toFixed(2)} ${symbol}`;
            });
        }

        function convertPrice(amount, fromCurrency, toCurrency) {
            if (fromCurrency === toCurrency) return amount;
            const rate = config.exchangeRates[fromCurrency][toCurrency];
            return amount * rate;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadConfig();
            
            // Language selector handler
            document.getElementById('language-selector').addEventListener('change', (e) => {
                updateLanguage(e.target.value);
            });

            // Initialize AOS
            AOS.init({
                duration: 1000,
                once: true
            });
        });

        // Cart functionality with multi-currency support
        let cart = [];
        
        function addToCart(product) {
            const currentCurrency = config.languages[currentLang].currency;
            const convertedPrice = convertPrice(product.price, 'PLN', currentCurrency);
            
            cart.push({
                ...product,
                price: convertedPrice,
                currency: currentCurrency,
                currencySymbol: config.languages[currentLang].currencySymbol
            });
            
            updateCart();
        }

        function updateCart() {
            const cartItems = document.getElementById('cart-items');
            cartItems.innerHTML = '';
            
            let subtotal = 0;
            const currencySymbol = config.languages[currentLang].currencySymbol;
            
            cart.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = 'flex justify-between items-center';
                itemElement.innerHTML = `
                    <span>${item.name}</span>
                    <span>${item.price.toFixed(2)} ${currencySymbol}</span>
                `;
                cartItems.appendChild(itemElement);
                subtotal += item.price;
            });
            
            const vatRate = config.languages[currentLang].vatRate / 100;
            const vat = subtotal * vatRate;
            const total = subtotal + vat;
            const currencySymbol = config.languages[currentLang].currencySymbol;
            
            document.getElementById('subtotal').textContent = `${subtotal.toFixed(2)} ${currencySymbol}`;
            document.getElementById('vat').textContent = `${vat.toFixed(2)} ${currencySymbol}`;
            document.getElementById('total').textContent = `${total.toFixed(2)} ${currencySymbol}`;
        }

        // Shipping calculator
        function calculateShipping(countryCode) {
            const shippingData = config.shipping.countries[countryCode];
            if (!shippingData) return 0;
            
            const currentCurrency = config.languages[currentLang].currency;
            return convertPrice(shippingData.shipping_cost, 'PLN', currentCurrency);
        }

        // Country selector for shipping
        function updateShippingCountries() {
            const countrySelect = document.getElementById('shipping-country');
            if (!countrySelect) return;

            countrySelect.innerHTML = '';
            Object.entries(config.shipping.countries).forEach(([code, data]) => {
                const option = document.createElement('option');
                option.value = code;
                option.textContent = data.name;
                countrySelect.appendChild(option);
            });
        }

        // Form validation with multilanguage support
        const validationMessages = {
            required: {
                pl: "To pole jest wymagane",
                en: "This field is required",
                de: "Dieses Feld ist erforderlich",
                fr: "Ce champ est obligatoire"
            },
            email: {
                pl: "Wprowadź poprawny adres email",
                en: "Enter a valid email address",
                de: "Geben Sie eine gültige E-Mail-Adresse ein",
                fr: "Entrez une adresse e-mail valide"
            },
            phone: {
                pl: "Wprowadź poprawny numer telefonu",
                en: "Enter a valid phone number",
                de: "Geben Sie eine gültige Telefonnummer ein",
                fr: "Entrez un numéro de téléphone valide"
            }
        };

        function validateForm(formId) {
            const form = document.getElementById(formId);
            let isValid = true;
            
            form.querySelectorAll('input[required], textarea[required]').forEach(input => {
                const errorDiv = input.nextElementSibling;
                if (!input.value.trim()) {
                    isValid = false;
                    input.classList.add('border-red-500');
                    if (errorDiv) {
                        errorDiv.textContent = validationMessages.required[currentLang];
                        errorDiv.classList.remove('hidden');
                    }
                } else if (input.type === 'email' && !validateEmail(input.value)) {
                    isValid = false;
                    input.classList.add('border-red-500');
                    if (errorDiv) {
                        errorDiv.textContent = validationMessages.email[currentLang];
                        errorDiv.classList.remove('hidden');
                    }
                }
            });

            return isValid;
        }

        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        // SEO optimization for multiple languages
        function updateMetaTags(lang) {
            const metaDescription = document.querySelector('meta[name="description"]');
            const metaKeywords = document.querySelector('meta[name="keywords"]');
            
            const descriptions = {
                pl: "OrganiCAM - inteligentny system monitoringu rolniczego. Modułowe wieże monitorujące dla nowoczesnego rolnictwa.",
                en: "OrganiCAM - intelligent agricultural monitoring system. Modular monitoring towers for modern agriculture.",
                de: "OrganiCAM - intelligentes landwirtschaftliches Überwachungssystem. Modulare Überwachungstürme für moderne Landwirtschaft.",
                fr: "OrganiCAM - système intelligent de surveillance agricole. Tours de surveillance modulaires pour l'agriculture moderne."
            };
            
            const keywords = {
                pl: "monitoring rolniczy, wieże monitorujące, rolnictwo, agro-monitoring",
                en: "agricultural monitoring, monitoring towers, agriculture, agro-monitoring",
                de: "Landwirtschaftliche Überwachung, Überwachungstürme, Landwirtschaft, Agrar-Monitoring",
                fr: "surveillance agricole, tours de surveillance, agriculture, agro-surveillance"
            };
            
            if (metaDescription) {
                metaDescription.content = descriptions[lang];
            }
            
            if (metaKeywords) {
                metaKeywords.content = keywords[lang];
            }
        }

        // Handle dynamic content loading
        async function loadModuleContent(moduleId) {
            const response = await fetch(`/api/modules/${moduleId}?lang=${currentLang}`);
            const moduleData = await response.json();
            
            const moduleContainer = document.getElementById(`module-${moduleId}`);
            if (moduleContainer && moduleData) {
                // Update module content with proper translations
                moduleContainer.querySelector('.title').textContent = moduleData.title;
                moduleContainer.querySelector('.description').textContent = moduleData.description;
                
                const featuresList = moduleContainer.querySelector('.features');
                featuresList.innerHTML = '';
                moduleData.features.forEach(feature => {
                    const li = document.createElement('li');
                    li.textContent = feature;
                    featuresList.appendChild(li);
                });
            }
        }

        // Initialize page with proper language
        async function initializePage() {
            const userLang = navigator.language.split('-')[0];
            const supportedLangs = Object.keys(config.languages);
            
            currentLang = supportedLangs.includes(userLang) ? userLang : 'en';
            document.getElementById('language-selector').value = currentLang;
            
            await updateLanguage(currentLang);
            updateMetaTags(currentLang);
            updateShippingCountries();
            
            // Load initial module content
            const moduleIds = ['base', 'power', 'monitoring'];
            moduleIds.forEach(id => loadModuleContent(id));
        }

        // Initialize everything when the page loads
        window.addEventListener('load', initializePage);
    </script>
</body>
</html>
